<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PCAPIFY</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}

body{
    margin:0;
    font-family:"Segoe UI", Arial;
    background:#000;
    color:#fff;
}

/* ===== Top Navbar ===== */
.navbar{
    height:60px;
    background:#000;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 30px;
    border-bottom:1px solid #444;
}
.navbar .logo{
    color:#fff;
    font-size:20px;
    font-weight:bold;
    letter-spacing:1px;
}
.navbar .menu a{
    color:#ccc;
    margin-left:20px;
    text-decoration:none;
    padding:8px 14px;
    border-radius:6px;
}
.navbar .menu a:hover{
    background:#fff;
    color:#000;
}

/* ===== Main ===== */
.main{
    padding:30px;
}

/* ===== Cards ===== */
.card{
    max-width:900px;
    margin:auto;
    background:#111;
    padding:25px;
    border-radius:10px;
    margin-bottom:30px;
    border:1px solid #333;
}
.card h2{
    color:#fff;
    margin-top:0;
}

/* ===== Inputs & Buttons ===== */
input, button{
    padding:10px;
    border-radius:6px;
}
input{
    width:100%;
    margin:10px 0;
    background:#000;
    color:#fff;
    border:1px solid #fff;
}
button{
    background:#fff;
    color:#000;
    border:none;
    cursor:pointer;
    font-weight:bold;
}
button:hover{
    background:#ccc;
}

/* ===== Error / Alert ===== */
.error{
    color:#ff2b2b;
    font-weight:bold;
}

/* ===== Graph ===== */
canvas{
    width:100%;
    background:#000;
    border-radius:8px;
    margin-top:20px;
}

/* ===== Utilities ===== */
.hidden{display:none}
ul{margin-left:20px}
</style>
</head>

<body>

<!-- ===== Top Menu Bar ===== -->
<div class="navbar">
    <div class="logo">PCAPIFY</div>
    <div class="menu hidden" id="mainMenu">
        <a href="#" id="menuDashboard" onclick="showPage('dashboard')">Dashboard</a>
        <a href="#" id="menuUpload" onclick="showPage('uploadPage')">Upload</a>
        <a href="#" id="menuResults" onclick="showPage('resultPage')">Results</a>
        <a href="#" id="menuAbout" onclick="showPage('about')">About</a>
        <a href="#" id="menuLogout" onclick="logout()">Logout</a>
    </div>
</div>

<div class="main">

<!-- Login -->
<div id="login" class="card">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginError" class="error hidden">Invalid username or password</p>
</div>

<!-- Dashboard -->
<div id="dashboard" class="card hidden">
    <h2>System Overview</h2>
    <p>
        PCAPIFY analyzes <b>PCAP (Packet Capture)</b> files to identify
        anomalous or suspicious network traffic.
    </p>
    <ul>
        <li>Abnormal traffic detection</li>
        <li>Intrusion attempt identification</li>
        <li>Network security visibility</li>
    </ul>
    <p><b>Total logins:</b> <span id="loginCount">0</span></p>
</div>

<!-- Upload -->
<div id="uploadPage" class="card hidden">
    <h2>Upload PCAP File</h2>
    <input type="file" id="pcapFile" accept=".pcap">
    <button onclick="analyzeFile()">Analyze</button>
    <p id="fileError" class="error hidden">Please select a PCAP file</p>
</div>

<!-- Results -->
<div id="resultPage" class="card hidden">
    <h2>Analysis Results</h2>
    <p><b>File:</b> <span id="resultFileName"></span></p>
    <ul id="anomalyList"></ul>

    <h3>Traffic Anomaly Line Graph</h3>
    <canvas id="lineGraph" height="250"></canvas>

    <h3>Anomaly Distribution Pie Chart</h3>
    <canvas id="pieChart" height="250"></canvas>
</div>

<!-- About -->
<div id="about" class="card hidden">
    <h2>About PCAPIFY</h2>
    <p>
        PCAPIFY is a cybersecurity analysis tool for detecting suspicious
        patterns in network packet captures.
    </p>
    <ul>
        <li>Intrusion Detection Systems (IDS)</li>
        <li>Network Forensics</li>
        <li>Security Operations Center (SOC)</li>
    </ul>
</div>

</div>

<script>
function showPage(id){
    document.querySelectorAll('.card').forEach(c=>c.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
}

// Login with counter
function login(){
    const user=document.getElementById('username').value;
    const pass=document.getElementById('password').value;
    const error=document.getElementById('loginError');

    if(user==="admin" && pass==="admin"){
        error.classList.add('hidden');
        document.getElementById('mainMenu').classList.remove('hidden');

        let count = localStorage.getItem('loginCount') || 0;
        count = parseInt(count) + 1;
        localStorage.setItem('loginCount', count);
        document.getElementById('loginCount').innerText = count;

        showPage('dashboard');
    } else{
        error.classList.remove('hidden');
    }
}

function logout(){
    document.getElementById('mainMenu').classList.add('hidden');
    showPage('login');
    document.getElementById('username').value="";
    document.getElementById('password').value="";
}

// Analyze PCAP file
<script>
async function analyzeFile(){
    const fileInput = document.getElementById("pcapFile");
    if(!fileInput.files.length){
        alert("Please select a PCAP file");
        return;
    }

    const formData = new FormData();
    formData.append("pcap", fileInput.files[0]);

    try{
        // Send file to backend
        const res = await fetch("http://127.0.0.1:5000/analyze", {
            method: "POST",
            body: formData,
            mode: "cors"
        });

        const data = await res.json();

        // Show filename
        document.getElementById("resultFileName").innerText = fileInput.files[0].name;

        // Populate anomaly list
        const list = document.getElementById("anomalyList");
        list.innerHTML = "";
        if(data.anomalies.length === 0){
            list.innerHTML = "<li>No anomalies detected</li>";
        } else {
            data.anomalies.forEach(a => {
                const li = document.createElement("li");
                li.innerText = a;
                list.appendChild(li);
            });
        }

        // Draw line graph
        drawLineGraph(data.scores);

        // Draw pie chart
        const high = data.scores.filter(v => v > 6).length;
        const normal = data.scores.length - high;
        drawPieChart(high, normal);

        // Show results page
        showPage("resultPage");

    } catch(err){
        alert("Backend error. Check Flask console.");
        console.error(err);
    }
}
</script>



// Line graph with data
let lineChart;
function drawLineGraph(data){
    const ctx=document.getElementById('lineGraph').getContext('2d');
    if(lineChart) lineChart.destroy();

    lineChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.map((_,i)=>"Pkt "+(i+1)),
            datasets: [{
                label: 'Anomaly Score',
                data: data,
                borderColor: '#00e6ff',
                backgroundColor: 'rgba(0,230,255,0.2)',
                fill: true,
                tension: 0.3,
                pointBackgroundColor: data.map(v => v>6 ? '#ff2b2b' : '#fff'),
                pointRadius: 6
            }]
        },
        options: {
            responsive:true,
            plugins:{
                legend:{display:true,color:'#fff'},
                tooltip:{enabled:true},
            },
            scales:{
                x:{
                    ticks:{color:'#fff'}
                },
                y:{
                    beginAtZero:true,
                    max:10,
                    ticks:{color:'#fff'}
                }
            }
        }
    });
}

// Pie chart
let pieChart;
function drawPieChart(anomalies, normal){
    const ctx=document.getElementById('pieChart').getContext('2d');
    if(pieChart) pieChart.destroy();

    pieChart = new Chart(ctx,{
        type:'pie',
        data:{
            labels:['High Anomaly','Normal'],
            datasets:[{
                data:[anomalies, normal],
                backgroundColor:['#ff2b2b','#00e6ff']
            }]
        },
        options:{
            plugins:{
                legend:{labels:{color:'#fff'}}
            }
        }
    });
}

// hide menu at start
document.getElementById('mainMenu').classList.add('hidden');
</script>

</body>
</html>


